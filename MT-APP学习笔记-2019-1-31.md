# MT

[Koa](https://koa.bootcss.com/)æ¡†æ¶ç±»ä¼¼äºexpressï¼Œå…¶ç›¸æ¯”äºexpressè€Œè¨€æ›´å°ï¼Œæ›´å¿«ã€‚åŒæ—¶æ”¯æŒES2017çš„è¯­æ³•ï¼Œè¿˜æœ‰çµæ´»çš„``Middleware``ä½¿å¾—``Koa``æ¡†æ¶èƒ½å¤Ÿå®Œæˆæ›´å¤šçš„å·¥ä½œ

``å®‰è£…&ä½¿ç”¨``

```shell
npm i -g koa-generator
koa2 project
```

### Koa2ä¸­é—´ä»¶

![1548991401984](/home/pchome/.config/Typora/typora-user-images/1548991401984.png)

```javascript
let app = new Koa();
const json = require('koa-json')
app.use(json())
```

ä¸Šé¢æ˜¯Koaä¸­é—´ä»¶çš„ç®€å•æ³¨å†Œä»¥åŠä½¿ç”¨ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªä¸­é—´ä»¶ï¼Œå„ä¸ªä¸­é—´ä»¶çš„é¡ºåºä¸ç›¸äº’å½±å“ï¼Œä»–ä»¬çš„æ‰§è¡Œé¡ºåºç±»ä¼¼äºä¸Šé¢çš„å›¾ç‰‡ï¼Œæ— è®ºä¸­é—´ä»¶å…ˆåæ³¨å†Œï¼Œéƒ½èƒ½å¾—åˆ°ç›¸åŒçš„è°ƒç”¨æœºä¼šï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè¯´æ˜ä¾‹å­

```javascript
function pv(ctx){
    console.log(ctx.path)
}
module.exports = function(){
    return async (ctx,next)=>{
        pv(ctx)
        await next()   //å°†æ‰§è¡Œæƒç§»äº¤ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
    }
}
```



````javascript
----------------m1.js------------------

function m1(ctx){
    console.log('m1')
}
module.exports = fucntion (){
    return async (ctx,next){
        console.log('m1 start')
        m1(ctx)
        await next()
        console.log('m1 end')
    }
}
----------------m2.js------------------

function m1(ctx){
    console.log('m2')
}
module.exports = fucntion (){
    return async (ctx,next){
        console.log('m2 start')
        m2(ctx)
        await next()
        console.log('m2 end')
    }
}
----------------m3.js------------------

function m1(ctx){
    console.log('m3')
}
module.exports = fucntion (){
    return async (ctx,next){
        console.log('m3 start')
        m3(ctx)
        await next()
        console.log('m3 end')
    }
}

----------------app.js------------------
const m1 = require('./m1')
const m2 = require('./m2')
const m3 = require('./m3')

app.use(m1())
app.use(m2())
app.use(m3())

m1 start
m2 start
m3 start
	<---GET /
index
GET / - 41ms
	--->GET / 200 98ms 226b
m3 end 
m2 end
m1 end

````

### koa-router

[koa-router](https://github.com/ZijianHe/koa-router)æ˜¯koaçš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œç”¨äºç”ŸæˆæœåŠ¡ç«¯è·¯ç”±

```javascript
import Router from 'koa-router'
let router = new Router({
	prefix:'/users'
})

router.get('/test',async (ctx)=>{
	ctx.body = {
        title:'koa-router'
	}
})
```



### koa-cookie

```javascript
ctx.cookies.set(name, value, [options])

ctx.cookies.set('name', 'tobi', { signed: true });


optionsçš„å…¨éƒ¨é€‰é¡¹
    maxAge ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä» Date.now() å¾—åˆ°çš„æ¯«ç§’æ•°
    signed cookie ç­¾åå€¼
    expires cookie è¿‡æœŸçš„ Date
    path cookie è·¯å¾„, é»˜è®¤æ˜¯'/'
    domain cookie åŸŸå
    secure å®‰å…¨ cookie
    httpOnly æœåŠ¡å™¨å¯è®¿é—® cookie, é»˜è®¤æ˜¯ true
    overwrite ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦è¦†ç›–ä»¥å‰è®¾ç½®çš„åŒåçš„ cookie (é»˜è®¤æ˜¯ false). å¦‚æœæ˜¯ true, åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­è®¾ç½®ç›¸åŒåç§°çš„æ‰€æœ‰ Cookieï¼ˆä¸ç®¡è·¯å¾„æˆ–åŸŸï¼‰æ˜¯å¦åœ¨è®¾ç½®æ­¤Cookie æ—¶ä» Set-Cookie æ ‡å¤´ä¸­è¿‡æ»¤æ‰ã€‚

cookieçš„è¯»å–

ctx.cookies.get('name');
```

### MongoDB

| SQLæœ¯è¯­/æ¦‚å¿µ | MongoDBæœ¯è¯­/æ¦‚å¿µ | è§£é‡Š/è¯´æ˜                           |
| ------------ | ---------------- | ----------------------------------- |
| database     | database         | æ•°æ®åº“                              |
| table        | collection       | æ•°æ®åº“è¡¨/é›†åˆ                       |
| row          | document         | æ•°æ®è®°å½•è¡Œ/æ–‡æ¡£                     |
| column       | field            | æ•°æ®å­—æ®µ/åŸŸ                         |
| index        | index            | ç´¢å¼•                                |
| table joins  |                  | è¡¨è¿æ¥,MongoDBä¸æ”¯æŒ                |
| primary key  | primary key      | ä¸»é”®,MongoDBè‡ªåŠ¨å°†_idå­—æ®µè®¾ç½®ä¸ºä¸»é”® |

å¯åŠ¨MongoDB

```shell
root@pchome-X550VQ /h/pchome# mongod
```

### RoBo 3T

mongoDBå¯è§†åŒ–å·¥å…·ç±»ä¼¼äºNavicat

### Mongoose

```javascript
-----------------Person.js-----------------------
import mongoose from 'mongoose'
let personSchema = new mongoose.Schema({
    name:String,
    age:Number
})
export default mongoose.model('Person',personSchema )
-----------------config.js------------------------
export default({
    dbs:'mongodb://127.0.0.1:27017/dbs'
})
-----------------app.js---------------------------
import mongoogse  from 'mongoose'
import dbConfig from './config.js'

mongoose.connect(dbconfig.dbs,{
    userNewUrlParser:true //å¿…éœ€optionï¼Œç”¨äºéªŒè¯
})

-----------------user.js------------------------

import  Preson  from './Person'
router.post('addPerson',async (ctx)=>{
    const person = new Person({
        name:ctx.request.body.name, //æ•°æ®æš‚å­˜
        age:ctx.request.body.age
    })
    let code;
    try{
    	await person.save()  //å°†æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“
    	code = 0
    }catch(e){
        code = 1
    }
    ctx.body = {
        code:code
    }
})

ä¿å­˜æ•°æ®é™¤äº†è°ƒç”¨å®ä¾‹æ–¹æ³•`save`å¤–ï¼Œè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å‹ä¸Šçš„æ–¹æ³• Model.create(docs[,callback(err,jellybean,snickers)])

Shortcut for saving one or more documents to the database. MyModel.create(docs) does new MyModel(doc).save()
```

``Person.js``ç”¨äºå»ºè¡¨çš„æ“ä½œï¼Œåœ¨mongoDBä¸­ç§°ä½œcollectionï¼Œè¯¥æ–‡ä»¶çš„åå­—å³ä¸ºè¡¨åï¼Œ``config.js``ç”¨äºé…ç½®å…¨å±€çš„mongooseè¿æ¥è®¾ç½®ï¼Œåœ¨``app.js``è¿›è¡Œåˆå§‹åŒ–è¿æ¥æ•°æ®åº“ï¼Œ``user.js``æ˜¯ç®€å•çš„å¯¹æ•°æ®åº“è¿›è¡Œå†™æ“ä½œï¼Œ`mongoose`æ˜¯ä¸€ä¸ªnpmåŒ…ï¼Œå¯ä»¥æ›´ç®€åŒ–çš„å¯¹`mongoDB`æ•°æ®åº“è¿›è¡Œæ“ä½œ

```javascript
æŸ¥
router.post('getPerson', async (ctx)=>{
    const results = await Person.findOne({name:ctx.request.body.name})
    const result = await Person.find({name:ctx.request.body.name})
    ctx.body={
        result,
        results
    }
})
```



ä¸Šé¢æ˜¯å¯¹æ•°æ®åº“çš„æŸ¥æ“ä½œï¼Œ`find`ä»¥åŠ`findOne`éƒ½æ˜¯ç›´æ¥é€šè¿‡æ¨¡å‹è°ƒç”¨ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰çš„å†™æ“ä½œï¼Œéœ€è¦é€šè¿‡æ–°å»ºæ¨¡å‹çš„å®ä¾‹å†è°ƒç”¨`save`æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥çœ‹æˆæ˜¯æŸ¥å’Œæ”¹æ“ä½œæ˜¯åŸå‹ä¸Šçš„é™æ€æ–¹æ³•ï¼Œå¢æ“ä½œæ˜¯å®ä¾‹æ–¹æ³•ï¼Œ``find``ä»¥åŠ`findOne`çš„åŒºåˆ«åœ¨äºåè€…ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œå‰è€…ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç¬¬ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„æ•°æ®

```javascript
æ”¹
router.post('/updatePerson',async (ctx)=>{
    const result = await Person.where({
        name:ctx.request.body.name
    }).update({
        age:ctx.request.body.age
    })
    ctx.body = {
       	//do something
    }
})

åˆ 

    const result = await Person.where({
        name:ctx.request.body.name
    }).remove()
```

æŸ¥æ“ä½œé€šè¿‡æ¨¡å‹ä¸Šçš„`where`æ–¹æ³•è¿›è¡Œæ•°æ®çš„å®šä½ï¼Œ`update`æ–¹æ³•è¿›è¡Œæ•°æ®æ›´æ–°

ä»¥ä¸Šåªæ˜¯æœ€åŸºç¡€çš„å¯¹æ•°æ®åº“æ“ä½œçš„æ–¹æ³•ï¼Œå…¨éƒ¨APIå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£[mongoose](https://mongoosejs.com/docs/guide.html)

### redis

httpåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸ºäº†è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œé€šè¿‡`session`ä»¥åŠ`cookie`è¿›è¡Œå‰åç«¯çš„è”è°ƒ

æœåŠ¡ç«¯ç”¨`session`ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ï¼Œå®¢æˆ·ç«¯ç”¨`cookie`å»ä¿å­˜`session`ï¼Œæ¯æ¬¡è¿›è¡Œæ¥å£çš„è®¿é—®éœ€è¦æºå¸¦`cookie`è¾¾åˆ°éªŒè¯èº«ä»½çš„æ•ˆæœï¼Œ`redis`ç”¨äºå­˜å‚¨`session,`ä¹Ÿå¯ä»¥é€šè¿‡`mongoDB`æˆ–è€…ç›´æ¥é€šè¿‡å°†æ•°æ®å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œä½†æ˜¯`redis`çš„æ€§èƒ½æ›´å¥½ï¼Œæ“ä½œæ›´ç®€ä¾¿

```shell
npm i koa-generic-session koa-redis --save

const session = require('koa-generic-session')
const Redis = require('koa-redis')
app.keys = ['keys','keyskeys'] //ç”¨äºRedisçš„åŠ å¯†æ“ä½œï¼Œä»»æ„æŒ‡å®šä¸¤ä¸ªkeyå³å¯
app.use(session({
	key:'mt',  //æ›´æ”¹cookieçš„é”®å
	prefix:'mtpre'
    store:new Redis() //å£°æ˜å°†sessionå­˜å‚¨åœ¨redisä¸­è€Œä¸æ˜¯å†…å­˜ä¸­
}))
```

ä»¥ä¸Šä¸¤ä¸ªä¸­é—´ä»¶åˆ†åˆ«æ˜¯å¯¹``redis``ä»¥åŠ``session``è¿›è¡Œæ“ä½œ

ä¸Šé¢æ˜¯å¯¹``session``è¿æ¥çš„æ“ä½œ

```
ctx.session.count++
```

å½“Koaçš„ä¸­é—´ä»¶å¯¹``session``è¿›è¡Œæ“ä½œåï¼ŒæœåŠ¡ç«¯ä¼šé»˜è®¤åœ¨å®¢æˆ·ç«¯æ·»åŠ ä¸¤æ¡cookie

```shell
root@pchome-X550VQ /h/p/r/src# ./redis-server 
pchome@pchome-X550VQ ~/r/src> ./redis-cli

å¯ä»¥åœ¨redis-cliä¸­æŸ¥çœ‹keyå€¼ï¼Œé€šè¿‡keys * å‘½ä»¤è·å–æ‰€æœ‰å­˜å‚¨çš„å€¼ï¼Œæ˜¯ç±»ä¼¼äºhashå€¼çš„å­—ç¬¦ä¸²
è·å–å…·ä½“çš„å­˜å‚¨çš„å€¼é€šè¿‡ ``get key``è¯»å–å…·ä½“æŒ‡
```

ä¸Šé¢è™½ç„¶æ²¡æœ‰ç›´æ¥æ“ä½œredisï¼Œä½†æ˜¯``koa-generic-session``ä¼šé»˜è®¤å°†æ•°æ®å­˜å‚¨åœ¨redisä¸­ã€‚

ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œredisçš„å­˜å‚¨

```
const Redis = require('koa-redus')
const Store = new Redis().client

router.get('/fix',async (ctx)=>{
    const st = await Store.hset('fix','name',Math.random())
})
```

### Nuxt.js

`Nuxt.js`åŸºäºvue2.0ç‰ˆæœ¬ã€‚åŒ…å«vue-routerï¼Œvue-metaï¼Œæ”¯æŒvuexæ•°æ®ç®¡ç†ï¼ŒåŒæ—¶æ”¯æŒSSRå³æœåŠ¡ç«¯æ¸²æŸ“

![](https://zh.nuxtjs.org/nuxt-schema.svg)

#### ç›®å½•ç»“æ„

![1549370801784](/home/pchome/.config/Typora/typora-user-images/1549370801784.png)

èµ„æºç›®å½• `assets` ç”¨äºç»„ç»‡æœªç¼–è¯‘çš„é™æ€èµ„æºå¦‚ `LESS`ã€`SASS` æˆ– `JavaScript`ã€‚



ç»„ä»¶ç›®å½• `components` ç”¨äºç»„ç»‡åº”ç”¨çš„ Vue.js ç»„ä»¶ã€‚Nuxt.js ä¸ä¼šæ‰©å±•å¢å¼ºè¯¥ç›®å½•ä¸‹ Vue.js ç»„ä»¶ï¼Œå³è¿™äº›ç»„ä»¶ä¸ä¼šåƒé¡µé¢ç»„ä»¶é‚£æ ·æœ‰ `asyncData` æ–¹æ³•çš„ç‰¹æ€§ã€‚



å¸ƒå±€ç›®å½• `layouts` ç”¨äºç»„ç»‡åº”ç”¨çš„å¸ƒå±€ç»„ä»¶ã€‚`<nuxt/>`  ç»„ä»¶ç”¨äºæ˜¾ç¤ºé¡µé¢çš„ä¸»ä½“å†…å®¹ã€‚

*å¯ä»¥é€šè¿‡ç¼–è¾‘* `layouts/error.vue` *æ–‡ä»¶æ¥å®šåˆ¶åŒ–é”™è¯¯é¡µé¢.è¿™ä¸ªé¡µé¢å¯ä»¥ä¸åŒ…å«`<nuxt/>`æ ‡ç­¾

å¸ƒå±€å¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œä¾‹å¦‚åœ¨`layouts`ç›®å½•ä¸‹æœ‰ä¸€ä¸ª`index.vue`ï¼Œå¸Œæœ›åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸ªå¸ƒå±€çš„è¯å¯ä»¥é€šè¿‡æŒ‡å®š

`layoutï¼š'index'`è¿›è¡Œåº”ç”¨



`satic`ç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„é™æ€æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä¸ä¼šè¢«`nuxt`è°ƒç”¨`webpack`è¿›è¡Œç¼–è¯‘ã€‚æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šæ˜ å°„è‡³åº”ç”¨çš„æ ¹è·¯å¾„ `/` ä¸‹ã€‚ä¾‹å¦‚å¼•ç”¨`static`ç›®å½•ä¸‹çš„`robots.txt`å¯ä»¥ä½¿ç”¨`robots.txt`



`store` ç›®å½•ç”¨äºç»„ç»‡åº”ç”¨çš„ [Vuex çŠ¶æ€æ ‘](http://vuex.vuejs.org/) æ–‡ä»¶ã€‚ Nuxt.js æ¡†æ¶é›†æˆäº† [Vuex çŠ¶æ€æ ‘](http://vuex.vuejs.org/) çš„ç›¸å…³åŠŸèƒ½é…ç½®ï¼Œåœ¨ `store` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `index.js` æ–‡ä»¶å¯æ¿€æ´»è¿™äº›é…ç½®ã€‚

Nuxt.js ä¼šå°è¯•æ‰¾åˆ°åº”ç”¨æ ¹ç›®å½•ä¸‹çš„ `store` ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•å­˜åœ¨ï¼Œå®ƒå°†åšä»¥ä¸‹çš„äº‹æƒ…ï¼š

1. å¼•ç”¨ `vuex` æ¨¡å—
2. å°† `vuex` æ¨¡å— åŠ åˆ° vendors æ„å»ºé…ç½®ä¸­å»
3. è®¾ç½® `Vue` æ ¹å®ä¾‹çš„ `store` é…ç½®é¡¹

ä½¿ç”¨æ™®é€šæ–¹å¼çš„çŠ¶æ€æ ‘ï¼Œéœ€è¦æ·»åŠ  `store/index.js` æ–‡ä»¶ï¼Œå¹¶å¯¹å¤–æš´éœ²ä¸€ä¸ª Vuex.Store å®ä¾‹ï¼š

```javascript
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

const store = () => new Vuex.Store({

  state: {
    counter: 0
  },
  mutations: {
    increment (state) {
      state.counter++
    }
  }
})

export default store

Nuxt.js å†…ç½®å¼•ç”¨äº† vuex æ¨¡å—ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚
```

å¯ä»¥åœ¨ç»„ä»¶é‡Œé¢é€šè¿‡ `this.$store` æ¥ä½¿ç”¨çŠ¶æ€æ ‘ï¼š

```
<template>
  <button @click="$store.commit('increment')">{{ $store.state.counter }}</button>
</template>
```

| `~` æˆ– `@`   | [srcç›®å½•](https://zh.nuxtjs.org/api/configuration-srcdir) |
| ------------ | --------------------------------------------------------- |
| `~~` æˆ– `@@` | [æ ¹ç›®å½•](https://zh.nuxtjs.org/api/configuration-rootdir) |

#### è·¯ç”±

åœ¨`nuxt`ä¸­è·¯ç”±ä¸éœ€è¦è‡ªå·±é…ç½®ï¼Œä»–ä¼šæ ¹æ®`pages`ç›®å½•çš„ç»“æ„è‡ªåŠ¨é…ç½®è·¯ç”±ï¼Œé€šè¿‡`nuxt-link`è¿›è¡Œè·¯ç”±è·³è½¬ï¼Œ`nuxt-link`ä¸`router-link`ç›¸åŒ

##### åŸºç¡€è·¯ç”±

å‡è®¾ `pages` çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
pages/
--| user/
-----| index.vue
-----| one.vue
--| index.vue
```

é‚£ä¹ˆï¼ŒNuxt.js è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹ï¼š

```
router: {
  routes: [
    {
      name: 'index',
      path: '/',
      component: 'pages/index.vue'
    },
    {
      name: 'user',
      path: '/user',
      component: 'pages/user/index.vue'
    },
    {
      name: 'user-one',
      path: '/user/one',
      component: 'pages/user/one.vue'
    }
  ]
}
```

å¯ä»¥é€šè¿‡ç¼–è¾‘ `layouts/error.vue` *æ–‡ä»¶æ¥å®šåˆ¶åŒ–é”™è¯¯é¡µé¢.*

#### ä¸ªæ€§åŒ–å¸ƒå±€

> `layouts` *æ ¹*ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½å±äºä¸ªæ€§åŒ–å¸ƒå±€æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é¡µé¢ç»„ä»¶ä¸­åˆ©ç”¨ `layout` å±æ€§æ¥å¼•ç”¨ã€‚

*è¯·ç¡®ä¿åœ¨å¸ƒå±€æ–‡ä»¶é‡Œé¢å¢åŠ  <nuxt/> ç»„ä»¶ç”¨äºæ˜¾ç¤ºé¡µé¢éå¸ƒå±€å†…å®¹ã€‚*

ä¸¾ä¸ªä¾‹å­ `layouts/blog.vue`:

```
<template>
  <div>
    <div>è¿™é‡Œæ˜¯åšå®¢å¯¼èˆª</div>
    <nuxt/>
  </div>
</template>
```

åœ¨ `pages/posts.vue` é‡Œï¼Œ å¯ä»¥æŒ‡å®šé¡µé¢ç»„ä»¶ä½¿ç”¨ blog å¸ƒå±€ã€‚

```
<script>
export default {
  layout: 'blog'
}
</script>
```

Nuxt.js ä¸ºé¡µé¢æä¾›çš„ç‰¹æ®Šé…ç½®é¡¹ï¼š

| å±æ€§å      | æè¿°                                                         |
| ----------- | ------------------------------------------------------------ |
| asyncData   | æœ€é‡è¦çš„ä¸€ä¸ªé”®, æ”¯æŒ [å¼‚æ­¥æ•°æ®å¤„ç†](https://zh.nuxtjs.org/guide/async-data)ï¼Œå¦å¤–è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå½“å‰é¡µé¢ç»„ä»¶çš„ [ä¸Šä¸‹æ–‡å¯¹è±¡](https://zh.nuxtjs.org/api#%E4%B8%8A%E4%B8%8B%E6%96%87%E5%AF%B9%E8%B1%A1)ã€‚ |
| fetch       | ä¸ `asyncData` æ–¹æ³•ç±»ä¼¼ï¼Œç”¨äºåœ¨æ¸²æŸ“é¡µé¢ä¹‹å‰è·å–æ•°æ®å¡«å……åº”ç”¨çš„çŠ¶æ€æ ‘ï¼ˆstoreï¼‰ã€‚ä¸åŒçš„æ˜¯ `fetch` æ–¹æ³•ä¸ä¼šè®¾ç½®ç»„ä»¶çš„æ•°æ®ã€‚è¯¦æƒ…è¯·å‚è€ƒ [å…³äºfetchæ–¹æ³•çš„æ–‡æ¡£](https://zh.nuxtjs.org/api/pages-fetch)ã€‚ |
| head        | é…ç½®å½“å‰é¡µé¢çš„ Meta æ ‡ç­¾, è¯¦æƒ…å‚è€ƒ [é¡µé¢å¤´éƒ¨é…ç½®API](https://zh.nuxtjs.org/api/pages-head)ã€‚ |
| layout      | æŒ‡å®šå½“å‰é¡µé¢ä½¿ç”¨çš„å¸ƒå±€ï¼ˆ`layouts` æ ¹ç›®å½•ä¸‹çš„å¸ƒå±€æ–‡ä»¶ï¼‰ã€‚è¯¦æƒ…è¯·å‚è€ƒ [å…³äº å¸ƒå±€ çš„æ–‡æ¡£](https://zh.nuxtjs.org/api/pages-layout)ã€‚ |
| loading     | å¦‚æœè®¾ç½®ä¸º`false`ï¼Œåˆ™é˜»æ­¢é¡µé¢è‡ªåŠ¨è°ƒç”¨`this.$nuxt.$loading.finish()`å’Œ`this.$nuxt.$loading.start()`,æ‚¨å¯ä»¥æ‰‹åŠ¨æ§åˆ¶å®ƒ,è¯·çœ‹[ä¾‹å­](https://nuxtjs.org/examples/custom-page-loading),ä»…é€‚ç”¨äºåœ¨nuxt.config.jsä¸­è®¾ç½®`loading`çš„æƒ…å†µä¸‹ã€‚è¯·å‚è€ƒ[APIé…ç½® `loading` æ–‡æ¡£](https://zh.nuxtjs.org/api/configuration-loading)ã€‚ |
| transition  | æŒ‡å®šé¡µé¢åˆ‡æ¢çš„è¿‡æ¸¡åŠ¨æ•ˆ, è¯¦æƒ…è¯·å‚è€ƒ [é¡µé¢è¿‡æ¸¡åŠ¨æ•ˆ](https://zh.nuxtjs.org/api/pages-transition)ã€‚ |
| scrollToTop | å¸ƒå°”å€¼ï¼Œé»˜è®¤: `false`ã€‚ ç”¨äºåˆ¤å®šæ¸²æŸ“é¡µé¢å‰æ˜¯å¦éœ€è¦å°†å½“å‰é¡µé¢æ»šåŠ¨è‡³é¡¶éƒ¨ã€‚è¿™ä¸ªé…ç½®ç”¨äº [åµŒå¥—è·¯ç”±](https://zh.nuxtjs.org/guide/routing#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1)çš„åº”ç”¨åœºæ™¯ã€‚ |
| validate    | æ ¡éªŒæ–¹æ³•ç”¨äºæ ¡éªŒ [åŠ¨æ€è·¯ç”±](https://zh.nuxtjs.org/guide/routing#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1)çš„å‚æ•°ã€‚ |
| middleware  | æŒ‡å®šé¡µé¢çš„ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶ä¼šåœ¨é¡µé¢æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨ï¼Œ è¯·å‚è€ƒ [è·¯ç”±ä¸­é—´ä»¶](https://zh.nuxtjs.org/guide/routing#%E4%B8%AD%E9%97%B4%E4%BB%B6)ã€‚ |

#### SSR

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„`SSR`ç¤ºä¾‹,æœåŠ¡ç«¯æ¸²æŸ“åœ¨äºå¯ä»¥æå‡ç”¨æˆ·ä½“éªŒï¼Œä»–ä¼šåœ¨æœåŠ¡ç«¯ä¸‹å‘æ–‡ä»¶çš„æ—¶å€™å°†æ•°æ®æ’å…¥åˆ°`HTML`æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨æ¸²æŸ“é¡µé¢åå‘èµ·è¯·æ±‚æ¸²æŸ“æ•°æ®ã€‚åŒæ ·çš„ï¼Œåœ¨`asyncData`ä¸­ä¸å¯ä»¥ä½¿ç”¨`this`ï¼Œå› ä¸ºæ­¤æ—¶è¿˜æ²¡æœ‰`vue`çš„å®ä¾‹

```
export default{
    data(){
        return{
            list:[]
        }
    },
    async asyncData(){
        let {status,data:{list}} = await axios.get('/city')
        if(status === 200){
            return{
                list
            }
        }
    }
}
```

`SSR`çš„åŸç†åœ¨äºåœ¨ä¸‹å‘`html`æ–‡ä»¶çš„æ—¶å€™ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ª`script`æ ‡ç­¾ï¼Œåœ¨`script`æ ‡ç­¾ä¸­å°†æºå¸¦æ•°æ®ä»¥åŠä¸€äº›é…ç½®é¡¹çš„`__NUXT__`å¯¹è±¡æŒ‚è½½åˆ°`window`å¯¹è±¡ä¸Š

```javascript
<script type="text/javascript">window.__NUXT__={"layout":"search","data":{data},"error":null,"serverRendered":true}</script>
```

### é…ç½®

`nuxt`ç”Ÿæˆçš„æ¨¡æ¿å¹¶ä¸èƒ½å®Œæ•´çš„æ”¯æŒ`es6`è¯­æ³•ï¼Œå¹¶ä¸”ä¸å¯ä»¥ç¼–è¯‘`sass`éœ€è¦å¢åŠ ä¸€äº›é…ç½®

```
touch .babelrc

npm i --save babel-preset-es2015 sass-loader sass-node

{
  "presets": ["es2015"]
}
```

```
vim package.json

"scripts": {
	"dev": "cross-env NODE_ENV=development nodemon server/index.js --watch server --exec babel-node"
} 
```

æ·»åŠ å…¨å±€`CSS`

```
        css:[
            'element-ui/lib/theme-chalk/reset.css',
            'element-ui/lib/theme-chalk/index.css',
            '@/assets/css/main.css'
        ]
```

### é¡¹ç›®ç»†èŠ‚

åœ¨å®šä¹‰ä¸€äº›é…ç½®é¡¹çš„æ—¶å€™ï¼Œå¯ä»¥å°†ä¸€äº›é…ç½®é¡¹å˜ä¸ºåªè¯»ï¼Œæé«˜å®‰å…¨æ€§

```javascript
export default{
    redis:{
        get host(){
            return '127.0.0.1'
        }
    }
}
å¦‚æœæ”¯æŒES6ï¼ŒES5å¯ä»¥ä½¿ç”¨Object.definePropertyæˆ–è€…Proxyå»æ”¹å†™`writable`å±æ€§

å¦‚æœéœ€è¦æ›´å¥½çš„å…¼å®¹æ€§ï¼Œå¯ä»¥é‡‡ç”¨æ¨¡å—æ¨¡å¼å»æ¨¡æ‹Ÿ

var CONFIG = (function() {
     var private = {
         'MY_CONST': '1',
         'ANOTHER_CONST': '2'
     };
ã€€ã€€
    return {
        get: function(name) { return private[name]; }
    }; 
})();

alert(CONFIG.get('MY_CONST'));  // 1

æœ€åä¸€ç§æ–¹æ³•æ˜¯é»˜è®¤å…¨å¤§å†™çš„å­—æ¯è¡¨ç¤ºå¸¸é‡ï¼Œå³çº¦å®šä¿—æˆ

var MY_CONSTANT = "some-value";
```

> é‚®ç®±éªŒè¯é‡‡ç”¨[nodemailer](https://nodemailer.com/about/)è§£å†³æ–¹æ¡ˆ

ä¸‹é¢æ˜¯ä¸€ä¸ªå‘é€é‚®ä»¶çš„ä¾‹å­ï¼Œå‘é€é‚®ä»¶çš„æœåŠ¡ç«¯å°½é‡é‡‡ç”¨ä¸è¦ä½¿ç”¨`gmail`ï¼Œå› ä¸º`google`å¥½åƒå¯¹è¿™æ–¹é¢æ¯”è¾ƒä¸¥ï¼Œ`sendMail`ç¬¬äºŒä¸ªå¯é€‰å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œ`error`å‚æ•°ç”¨äºå›ä¼ é”™è¯¯

```javascript
const nodemailer = require("nodemailer");

// async..await is not allowed in global scope, must use a wrapper
async function main(){

  // Generate test SMTP service account from ethereal.email
  // Only needed if you don't have a real mail account for testing
  let account = await nodemailer.createTestAccount();

  // create reusable transporter object using the default SMTP transport
  let transporter = nodemailer.createTransport({
    host: "smtp.ethereal.email",
    port: 587,
    secure: false, // true for 465, false for other ports
    auth: {
      user: account.user, // generated ethereal user
      pass: account.pass // generated ethereal password
    }
  });
  let mailOptions = {
    from: '"Fred Foo ğŸ‘»" <foo@example.com>', // sender address
    to: "bar@example.com, baz@example.com", // list of receivers
    subject: "Hello âœ”", // Subject line
    text: "Hello world?", // plain text body
    html: "<b>Hello world?</b>" // html body
  };
  let info = await transporter.sendMail(mailOptions,callback)
}

main().catch(console.error);
```

### Passport
> ç™»å½•éªŒè¯é‡‡ç”¨[passport](http://www.passportjs.org/docs/username-password/)éªŒè¯

> [ä½¿ç”¨passportjsè¿›è¡Œç™»å½•éªŒè¯](https://segmentfault.com/a/1190000002926232)è¿™ç¯‡åšå®¢è®²çš„æ¯”è¾ƒè¯¦ç»†ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹

```javascript
--------------------passport.js--------------------
import passport from 'koa-passport'

é‡‡ç”¨[passport-localç­–ç•¥](https://github.com/jaredhanson/passport-local)
                     
import LocalStrategy from 'passport-local'
                     
å¯¼å…¥mongooseæ¨¡å‹
                     
import UserModel from '../../dbs/models/users'
passport.use(
    new LocalStrategy(async function(username, password, done) {
        let where = {
            username
        }
        //æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        let result = await UserModel.findOne(where)
        if (result != null) {
        	//æ ¡éªŒå¯†ç æ˜¯å¦æ­£ç¡®
            if (result.password === password) {
                return done(null, result)
            } else {
                return done(null, false, "å¯†ç é”™è¯¯")
            }
        } else {
            return done(null, false, "ç”¨æˆ·ä¸å­˜åœ¨")
        }
    })
)

passport.serializeUser((user, done) => {
    done(null, user)
})
passport.deserializeUser((user, done) => {
    return done(null, user)
})
export default passport;
--------------------user.js--------------------
import Passport from './passport.js'
router.post('/signin', async(ctx, next) => {
        return Passport.authenticate("local", function(err, user, info, status) {
            console.log('err,user,info,status', err, user, info, status);
            if (err) {
                ctx.body = {
                    code: -1,
                    msg: err
                }
            } else {
                if (user) {
                    ctx.body = {
                        code: 0,
                        msg: "ç™»å½•æˆåŠŸ",
                        user
                    }
                    return ctx.login(user)
                } else {
                    ctx.body = {
                        code: 1,
                        msg: info
                    }
                }
            }
        })(ctx, next)
    })
    
ä¸Šé¢çš„é—­åŒ…çš„æ–¹å¼å°†ctxä»¥åŠnextå›ä¼ ç»™authenticateå‡½æ•°ï¼Œä¸‹é¢æ˜¯å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸€éƒ¨åˆ†çš„è¯´æ˜

 In this example, note that authenticate() is called from within the route handler, rather than being used as route middleware. This gives the callback access to the req and res objects through closure.

If authentication failed, user will be set to false. If an exception occurred, err will be set. An optional info argument will be passed, containing additional details provided by the strategy's verify callback.

The callback can use the arguments supplied to handle the authentication result as desired. Note that when using a custom callback, it becomes the application's responsibility to establish a session (by calling req.login()) and send a response.
 
 
 router.get('/exit', async(ctx, next) => {
        await ctx.logout()
             //åˆ¤æ–­æ˜¯å¦ç™»å½•
        if (!ctx.isAuthenticated()) {
            ctx.body = {
                code: 0
            }
        } else {
            ctx.body = {
                code: -1
            }
        }
    })

ç™»å½•é€šè¿‡è‡ªå®šä¹‰çš„é…ç½®è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœæ ¡éªŒé€šè¿‡ï¼Œæ‰§è¡Œ`passport`æš´éœ²åœ¨ctxä¸Šçš„å‡½æ•°`login()`å®Œæˆç™»å½•åŠ¨ä½œ
é€€å‡ºä¸éœ€è¦æ ¡éªŒï¼Œåªéœ€è¦ç›‘æ§é”™è¯¯å¹¶é€€å‡ºç™»å½•æ€å³å¯ã€‚logout()æ–¹æ³•åŒæ ·ä¹Ÿæ˜¯ç”±`passport`æš´éœ²åœ¨`ctx`ä¸Š
```

```javascript
è·å–ç”¨æˆ·ä¿¡æ¯

å½“æˆåŠŸç™»é™†åpassportä¼šè‡ªåŠ¨å°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨`session`å¯¹è±¡ä¸­ï¼Œå¯ä»¥é€šè¿‡`session`å¯¹è±¡ä¸­çš„`passport`æ¨¡å—è¯»å–ç”¨æˆ·ä¿¡æ¯
router.get('/getUser', async(ctx) => {
    if (ctx.isAuthenticated()) {
        const {
            username,
            email
        } = ctx.session.passport.user
        ctx.body = {
            user: username,
            email
        }
    } else {
        ctx.body = {
            user: "",
            email: ""
        }
    }
})
```

> æ³¨å†Œæ—¶å‘é€å¯†ç ä¸è¦æ˜æ–‡ä¼ è¾“ï¼Œé‡‡ç”¨CryptoJsçš„MD5åŠ å¯†

```javascript
this.$axios.post('/users/signup', {
	username: window.encodeURIComponent(this.ruleForm.name),
	password: CryptoJs.MD5(this.ruleForm.pwd).toString(),
	email: this.ruleForm.email,
	code: this.ruleForm.code
}).then(({ status, data }) => {
	//do something
})
```

åŸå¸‚å®šä½é‡‡ç”¨SSRæ–¹æ¡ˆï¼Œå…·ä½“å®ç°æ€è·¯æ˜¯

1. æœåŠ¡ç«¯å®šä¹‰getPositionæ¥å£ï¼Œæ ¹æ®ipåœ°å€å®šä½åŸå¸‚å¹¶è¿”å›åŸå¸‚ä¿¡æ¯
2. å®šä¹‰VueXå­æ¨¡å—geoï¼Œå­˜å‚¨åŸå¸‚æ•°æ®ï¼Œæš´éœ²actionæ–¹æ³•æ›´æ”¹æ•°æ®
3. åœ¨Storeä¸‹çš„indexæ–‡ä»¶ä¸­è°ƒç”¨nuxtæä¾›çš„nuxtServerInitæ–¹æ³•
4. åœ¨ç›¸å…³æ–‡ä»¶ä¸­ä»vuexä¸­è¯»å–æ•°æ®

```javascript
import Vue from "vue"
import Vuex from "vuex"
import geo from "./modules/geo"

Vue.use(Vuex)

const store = () => new Vuex.Store({
    modules: {
        geo
    },
    actions: {
        async nuxtServerInit({commit}, {req,app}) {
        const {status,data: {province,city}} = await app.$axios.get('/geo/getPosition')
		commit('geo/setPosition', status === 200 ? {city,province}:{city: '',province: ''})
        }
    }
})
export default store
```

åˆ†ç±»åœ¨ä¸»é¡µä¸Šä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œæ‰€ä»¥ä¹Ÿé‡‡ç”¨SSRæ¸²æŸ“ï¼Œå°†æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨VueXä¸­ï¼Œè°ƒç”¨nuxtServerInitè·å–å¹¶æäº¤æ•°æ®ï¼Œè¿™æ ·å¯¹äºé¡µé¢çš„å±•ç¤ºæ˜¯æ¯”è¾ƒå‹å¥½çš„



æœç´¢å»ºè®®é‡‡ç”¨é˜²æŠ–å¤„ç†ï¼Œå¼•å…¥[lodashjs](https://www.lodashjs.com/docs/4.17.5.html)çš„debounceæ¨¡å—è¿›è¡Œå¤„ç†

> Tips
>
> ```
> å¦‚æœæŒ‡å®šå…ƒç´ çš„leftï¼Œtopï¼Œrightï¼Œbottoméƒ½ä¸º0ï¼Œä¸”å…ƒç´ ä¸ºabsoluteçš„è¯ã€‚é‚£ä¹ˆå…ƒç´ å°†å æ»¡æ•´ä¸ªå±å¹•ã€‚é€šå¸¸ç”¨ä½œé®ç½©å±‚ã€‚
> å¦‚æœæŒ‡å®šäº†å®½é«˜å¹¶è®¾ç½®marginä¸ºautoå…ƒç´ å°†ä¸Šä¸‹å·¦å³å±…ä¸­
> ```
>
> ```css
> è®¾ç½®å…ƒç´ ä¸‹æ–¹å°å°–è§’
> .hw{
> 	width:120px;
> 	height:20px;
> }
> .hw:after{
> 	position: relative;
> 	border-left: 5px solid transparent;
> 	border-right: 5px solid transparent;
> 	border-bottom: 7px solid #888;
> 	content: " ";
> 	display: block;
> 	width: 2px;
> 	height: 2px;
> 	top: 0px;
> 	left:0;
> 	right:0;
> 	margin:autoï¼›
> }
> ```



> è·å–æ±‰å­—å…¨æ‹¼é€šè¿‡npmåº“`js-pinyin`

`slot-soped`ä¹Ÿå¯ä»¥å®ç°å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ï¼Œç¥å¥‡

> ## Main
>
> Vue ------ [VUE](cn.vuejs.org)
>
> UIæ¡†æ¶ ------  [Element](http://element-cn.eleme.io/#/zh-CN)
>
> SSRæœåŠ¡ç«¯æ¸²æŸ“ ------ [Nuxt](https://zh.nuxtjs.org/)
>
> ServeræœåŠ¡ç«¯ ------ [Koa](https://koa.bootcss.com/)
>
> DataBaseæ•°æ®åº“ ------ [MongoDB](https://www.mongodb.com/)
>
> Store ------ [redis](https://redis.io/)
>
> ## other
>
> router ------ [Koa-router](https://www.npmjs.com/package/koa-router)
>
> Koa To DataBase ------ [mongoose](https://mongoosejs.com/docs/guide.html)
>
> Koa To Redis ------ [Koa-redis](https://www.npmjs.com/package/koa-redis)
>
> koa-routerå¤„ç†postè¯·æ±‚ ------ [Koa-bodyparser](https://www.npmjs.com/package/koa-bodyparser)
>
> koaå­˜å‚¨session ------ [Koa-generic-session](https://www.npmjs.com/package/koa-generic-session)
>
> ç™»å½•å®‰å…¨æ ¡éªŒ ------ [passport](http://www.passportjs.org/docs/)
>
> Http-request ------ [axios](https://www.npmjs.com/package/axios)
>
> Es6ç¼–è¯‘ ------babel
>
> æ•°æ®åŠ å¯† ------ [crypto](https://nodejs.org/api/crypto.html)
>
> Jså·¥å…·åº“ä½¿ç”¨é˜²æŠ–ä»¥åŠèŠ‚æµ ------ [Lodash](https://lodash.com/)
>
> SMTPæœåŠ¡ ------ [Nodemailer](https://nodemailer.com/about/)
>
> CSSé¢„å¤„ç† ------ [sass](https://www.sass.hk/)
>
> è¯­æ³•è§„èŒƒ ------eslint
>
> 